<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neuedu.hospitalbackend.model.dao.ExaminationMapper">

    <resultMap id="ExaminationResultMap" type="Examination">
        <id column="id" property="id"/>
        <result column="case_id" property="caseId"/>
        <result column="project_id" property="projectId"/>
        <result column="status" property="status"/>
        <result column="goal" property="goal"/>
        <result column="result_description" property="resultDescription"/>
        <result column="result_image" property="resultImage"/>
        <result column="creator_role_id" property="creatorRoleId"/>
        <result column="examination_role_id" property="examinationRoleId"/>
        <result column="advice" property="advice"/>
        <result column="requirement" property="requirement"/>
    </resultMap>

    <select id="listPreparedExaminationPatientsByCaseIdOrName" resultType="HashMap">
        select c.registration_id, c.patient_name
        from patient_ase c, examination e, transaction_log t
        where e.id = t.collection_id and e.project_id = t.project_id
        and e.status = 2 and t.status = 2
        and e.case_id = c.registration_id
        <choose>
            <when test = "caseId != null">
                and c.registration_id = #{caseId}
            </when>
            <when test="patientName != null and patientName != ''">
                and c.patient_name = #{patientName}
            </when>
        </choose>
    </select>
</mapper>